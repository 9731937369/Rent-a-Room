<div class="container">
    <%= form_for(@room) do |f| %>
      <% if @room.errors.any? %>
        <div id="error_explanation">
          <h2><%= pluralize(@room.errors.count, "error") %> prohibited this room from being saved:</h2>

          <ul>
          <% @room.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
          </ul>
        </div>
      <% end %>

      <div class="row">
        <div class="col-xs-2">
          <%= link_to 'Back', rooms_path, class: "btn btn-primary btn-sm" %>
        </div>
      </div>
      <br>
      <div class="row">
        <div class="col-xs-1">
          <%= f.label :name %>
        </div>
        <div class="col-xs-3">
          <div class="form-group">
            <%= f.text_field :name, class: "form-control input-sm" %>
            <span id="nameMsg"></span>
          </div>
        </div>
        <div class="col-xs-offset-2 col-xs-1">
          <%= f.label :description %><br>
        </div>
        <div class="col-xs-4">
          <%= f.text_area :description, class: "form-control input-sm" %>
          <span id="descriptionMsg"></span>          
        </div>
      </div>

      <br/>

      <div class="row">
        <div class="col-xs-1">
          <%= f.label :price %>
        </div>
        <div class="col-xs-3">
          <%= f.text_field :price, class: "form-control input-sm" %>
          <span id="priceMsg"></span>          
        </div>
        <div class="col-xs-offset-2 col-xs-1">
          <%= f.label :rules %>
        </div>
        <div class="col-xs-4">
          <%= f.text_area :rules, class: "form-control input-sm" %>
          <span id="rulesMsg"></span>
        </div>
      </div>

      <br>
      
      <div class="row">
        <div class="col-xs-1">
          <%= f.label :images %><br>
        </div>
        <div class="col-xs-3">
          <%= f.file_field :images , class: "form-control input-sm"%>
        </div>
        <div class="col-xs-offset-2 col-xs-1">
          <%= f.label :address %><br>
        </div>
        <div class="col-xs-4">
          <%= f.text_area :address, class: "form-control input-sm" %>
          <span id="addressMsg"></span>          
        </div>
      </div>
      
      <br>
      
      <div class="row">
        <div class="col-xs-1">
          <%= f.label :city %>
        </div>
        <div class="col-xs-3">
          <div class="form-group">
            <%= f.collection_select :city_id, City.all, :id, :name, {prompt: "Select City"}, {class: "form-control input-sm"} %>
          </div>          
        </div>
        <div class="col-xs-offset-2 col-xs-1">
          <%= f.label :amenities%>
        </div>
        <div class="col-xs-4">
          <div class="checkbox">
            <%= f.collection_check_boxes :amenity_ids, Amenity.all, :id, :name do |course|%>
            <label>
              <%= course.check_box %>
              <%= course.text%>
            </label>
            <%end%>
          </div>          
        </div>
      </div>

      <div class="actions">
        <div class="row">
          <div class="col-xs-offset-5">
            <%= f.submit "Add Room", class: "btn btn-primary btn-sm" %>
          </div>
        </div>
      </div>
    <% end %>
</div>
<script>
  var nameHandle = document.getElementById('room_name');
  var descriptionHandle = document.getElementById('room_description');
  var priceHandle = document.getElementById('room_price');
  var rulesHandle = document.getElementById('room_rules');
  var addressHandle = document.getElementById('room_address');
  var imagesHandle = document.getElementById('room_images');
  var roomFormHandle = document.getElementById('new_room');

  var nameMsgHandle = document.getElementById('nameMsg');
  var descriptionMsgHandle = document.getElementById('descriptionMsg');
  var priceMsgHandle = document.getElementById('priceMsg');
  var rulesMsgHandle = document.getElementById('rulesMsg');
  var addressMsgHandle = document.getElementById('addressMsg');
  var imagesMsgHandle = document.getElementById('imagesMsg');

  var priceFormatter = /^[0-9]*(?:\.\d{1,2})?$/;

  var errors = {
    name: false,
    description: false,
    price: false,
    rules: false,
    address: false,
    images:false
  }

  function validateName(){
    if(nameHandle.value == ""){
      nameMsgHandle.innerHTML = "Can't be blank";
      errors.name = false;
    }else if(nameHandle.value.length < 5){
      nameMsgHandle.innerHTML = "Room name should  be more than 5 characters.";
      errors.name = false;
    }else{
      nameMsgHandle.innerHTML = "";
      errors.name = true;
    }
  }

  function validateDescription(){
    if(descriptionHandle.value == ""){
      descriptionMsgHandle.innerHTML = "Can't be blank";
      errors.description = false;
    }else{
      descriptionMsgHandle.innerHTML = "";
       errors.description = true;
    }
  }

  function validatePrice(){
    if(priceHandle.value == ""){
      priceMsgHandle.innerHTML = "Can't be blank";
      errors.price = false;
    }else if(!priceFormatter.test(priceHandle.value)){
      priceMsgHandle.innerHTML = " Price should contain only number";
      errors.price = false;
    }else{
      priceMsgHandle.innerHTML = "";
      errors.price = true;
    }
  }

  function validateRules(){
    if(rulesHandle.value == ""){
      rulesMsgHandle.innerHTML = "Can't be blank";
      errors.rules = false;
    }else{
      rulesMsgHandle.innerHTML = "";
      errors.rules = true;
    }
  }

  function validateAddress(){
    if(addressHandle.value == ""){
      addressMsgHandle.innerHTML = "Can't be blank";
      errors.address = false;
    }else{
      addressMsgHandle.innerHTML = "";
      errors.address = true;
    }
  }

  function validateimages(){
    if(imagesHandle.value == ""){
      imagesMsgHandle.innerHTML = "Can't be blank";
      errors.images = false;
    }else{
      imagesMsgHandle.innerHTML ="";
      errors.images = true;
    }
  }

roomFormHandle.addEventListener('submit',function(e){
  validateName();
  validateDescription();
  validatePrice();
  validateRules();
  validateAddress();
  validateimages();

  if(Object.values(errors).includes(false)){
      e.preventDefault();

  }

},false);
</script>
